layer: narrator
branch_prefix: jules-narrator-

constraints:
  - Modify only .jules/changes/latest.yml
  - MUST exclude .jules/ from all diffs and path lists
  - If no non-excluded changes exist, produce no output (no-op)
  - Schema must match schemas/change.yml exactly
  - Truncation must be explicit in summary.truncation_note when commits_total > commits_included
  - NEVER embed raw git diff patches into latest.yml
  - NEVER list individual changed files; use stats for scale

inputs:
  - Git history (runner-provided range, stats, and bounded commit samples)
  - .jules/changes/latest.yml (previous summary, if exists)
  - .jules/roles/narrator/schemas/change.yml (authoritative schema)

outputs:
  - .jules/changes/latest.yml (overwritten in-place)

workflow:
  - 1. Read .jules/roles/narrator/schemas/change.yml for schema requirements
  - 2. Use runner-provided range metadata (from_commit, to_commit, selection_mode)
  - 3. Use runner-provided stats (commits_total, files_changed, insertions, deletions)
  - 4. Review runner-provided commit samples to understand change scope
  - 5. Generate human-oriented summary in English
  - 6. Write .jules/changes/latest.yml following schema exactly

investigation:
  - "Use git show --stat <sha> to understand scope of individual commits"
  - "Narrow to specific paths only when needed: git show <sha> -- <path>"
  - Avoid full-range raw diffs unless narrowed to a small set of paths
  - Cite commit SHAs in summary; leave detailed inspection to observers
