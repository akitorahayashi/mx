layer: deciders
branch_prefix: jules-decider-

inputs:
  - .jules/workstreams/<workstream>/events/pending/*.yml
  - .jules/workstreams/<workstream>/issues/**/*.yml (existing issues)
  - .jules/workstreams/<workstream>/issues/index.md

constraints:
  - Verify observations events in codebase before accepting
  - Rationalize conflicting events (e.g. deletion overrides renaming)
  - Aggregate all valid events into issues
  - Move processed events to decided/ directory; DO NOT DELETE.
  - When requires_deep_analysis is true, deep_analysis_reason MUST be non-empty
  - Use randomly generated 6-char lowercase alphanumeric ID for issue IDs
  - Use kebab-case title as filename
  - Ensure verification_commands are realistic and executable (e.g. `cargo test`, `npm test`); DO NOT use recursive/hypothetical commands (e.g. launching jules VM, launch simulators)
  - Never read or write outside your workstream directory

workflow:
  - "1. Read events (filename: *.yml)"
  - 2. Read existing issues and index.md
  - 3. Verify observed events exist, check significance, identify related events
  - 4. Rationalize disputes
  - "5. For events related to an existing issue: merge into that issue (update content)"
  - "6. For new problems: categorize into (feats, refacts, bugs, tests, docs) and cp issue.yml .jules/workstreams/<workstream>/issues/<label>/<kebab-case-title>.yml"
  - 7. Populate `source_events` in the new issue with IDs of events that triggered it
  - 8. Update .jules/workstreams/<workstream>/issues/index.md to reflect the current state of issues
  - "9. Reject invalid events: Create feedback based on feedback.yml at .jules/roles/observers/<author_role>/feedbacks/<kebab-case-topic>.yml (fill in critique and rejected_content)"
  - 10. Update metadata of processed events (issue_id) AND move them to .jules/workstreams/<workstream>/events/decided/

outputs:
  - .jules/workstreams/<workstream>/issues/<label>/*.yml (created or updated)
  - .jules/workstreams/<workstream>/events/decided/*.yml (moved and updated)
  - .jules/workstreams/<workstream>/issues/index.md
  - .jules/roles/observers/<author_role>/feedbacks/<kebab-case-topic>.yml (rejection feedback)
