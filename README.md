# mix

`mix` is a Rust CLI that unifies two daily workflows:

1. **Snippet copying** – type `mix <snippet>` (for example `mix wc`) to stream any markdown snippet under
   `~/.config/mix/commands/` into your clipboard.
2. **Slash asset generation** – run `mix slash <target>` to convert the shared snippet/config catalog into
   the Codex, Claude, or Gemini command formats previously generated by the Python tooling in `reference/menv`.

The project started from `rs-cli-tmpl`, keeping the layered architecture (CLI → command handlers → core logic
→ storage) while replacing the sample CRUD commands with real snippet-aware behaviors.

## Storage layout

```text
~/.config/mix/
  config.yml          # shared metadata describing command titles/descriptions + prompt relative paths
  commands/
    w/wc.md
    sdd/sdd-0-rq.md
    ... (any nested directory structure)
```

- **Snippet lookup** scans `commands/` recursively for `.md` files. Both `mix wc` and `mix w/wc` resolve to
  `commands/w/wc.md`.
- **Slash generation** reads `config.yml`, validates that every `prompt-file` stays inside the commands tree,
  and writes to:
  - `~/.codex/prompts/<key>.md`
  - `~/.claude/commands/<key>.md`
  - `~/.gemini/commands/<key>.toml`

## CLI usage

```bash
# List available snippets with metadata pulled from config.yml
mix list

# Copy a snippet into the clipboard (uses pbcopy/wl-copy/xclip/clip automatically)
mix wc

# Generate assets for a single target
mix slash claude

# Generate everything (Codex, Claude, Gemini) in one pass
mix slash all

Note: `mix slash` commands display a progress bar during generation and show a summary of generated artifacts at the end.
```

### Environment overrides

| Variable            | Purpose                                                                                 |
|---------------------|-----------------------------------------------------------------------------------------|
| `MIX_COMMANDS_ROOT` | Override the default `~/.config/mix` root (useful for testing or custom installations). |
| `MIX_CLIPBOARD_FILE`| Write clipboard contents to a file instead of invoking pbcopy/wl-copy/xclip/clip.       |
| `MIX_CLIPBOARD_CMD` | Provide a custom clipboard command if the auto-detected one is unavailable.             |
| `MIX_CODEX_DIR`     | Custom destination for Codex prompts (defaults to `~/.codex/prompts`).                  |
| `MIX_CLAUDE_DIR`    | Custom destination for Claude prompts (defaults to `~/.claude/commands`).               |
| `MIX_GEMINI_DIR`    | Custom destination for Gemini prompts (defaults to `~/.gemini/commands`).               |

## Development guide

```bash
cargo fmt --check
cargo clippy --all-targets --all-features -- -D warnings
RUST_TEST_THREADS=1 cargo test --all-targets --all-features
```

The workspace follows the original template’s testing culture:

- **Unit tests** live next to their modules (clipboard abstraction, snippet storage, slash generators).
- **Core support** (`src/core/test_support.rs`) provides in-memory clipboard stubs and scratch snippet roots.
- **Integration crates** under `tests/` exercise both the CLI (`cli_commands.rs`, `cli_flow.rs`) and the
  public library API (`commands_api.rs`). Shared helpers in `tests/common/` seed snippet catalogs inside a
  temporary HOME and expose utilities for overriding clipboard/destination paths.

## Migrating from `reference/menv`

1. Copy the existing markdown prompts into `~/.config/mix/commands/` while preserving subdirectories.
2. Bring over `config.yml` (previously under `ansible/roles/slash/config/common/config.yml`).
3. Run `mix list` to verify the catalog, then `mix slash all` to regenerate the Codex/Claude/Gemini assets.

That’s it—you now have a single Rust binary covering both snippet copy flows and slash command generation.
